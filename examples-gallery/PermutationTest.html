

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Permutation Test &mdash; Reproducible Research</title>
    
    <link rel="stylesheet" href="../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Reproducible Research" href="../index.html" />
    <link rel="up" title="Gallery of examples" href="../ExamplesGallery.html" />
    <link rel="next" title="Bayesian Linear Regression" href="bayes-linreg.html" />
    <link rel="prev" title="Python Plots in LaTeX" href="PlotsPythonInLatex.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../index.html">
            <img class="logo" src="../_static/logo.png" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="../index.html">Reproducible Research</a></div>
        <div class="rel">
          <a href="PlotsPythonInLatex.html" title="Python Plots in LaTeX"
             accesskey="P">previous</a> |
          <a href="bayes-linreg.html" title="Bayesian Linear Regression"
             accesskey="N">next</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="permutation-test">
<h1>Permutation Test<a class="headerlink" href="#permutation-test" title="Permalink to this headline">¶</a></h1>
<p>Permutation tests are a group of nonparametric statistics.  Here we use a permutation test to test the null hypothesis that two different groups come from the same distribution.  The notation and examples shown here are borrowed from Efron and Tibshirani&#8217;s <em>An Introduction to the Bootstrap</em> [1].  Our specific problem is that we observe two groups of data</p>
<div class="math">
<p><img src="../_images/math/78eb4be016cf0e2eb089a16be8305bd78338db53.png" alt="\begin{eqnarray*}
    F \rightarrow \mathbf{z} &amp;= \{ z_{1}, \ldots, z_{n} \}\\
    G \rightarrow \mathbf{y} &amp;= \{ y_{1}, \ldots, y_{m} \}
\end{eqnarray*}"/></p>
</div><p>and we are interested in testing the null hypothesis that</p>
<div class="math">
<p><img src="../_images/math/636316184287228f0d370099149235994932b564.png" alt="H_{0}: F = G."/></p>
</div><div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h2>
<p>In the case of this example the following data are survival times for treatment <img class="math" src="../_images/math/b13f21416d84e13708696f34dea81026cda583c9.png" alt="z"/> and control <img class="math" src="../_images/math/092e364e1d9d19ad5fffb0b46ef4cc7f2da02c1c.png" alt="y"/> groups.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">94</span><span class="p">,</span><span class="mi">197</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">23</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">52</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">146</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">51</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">46</span><span class="p">])</span>
</pre></div>
</div>
<p>We note that the difference among the means hints that the treatment group may have longer survival times in general.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">theta_hat</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">theta_hat</span>
<span class="go">30.6349206349</span>
</pre></div>
</div>
<p>Here we run the permutation test</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">run_permutation_test</span><span class="p">(</span><span class="n">pooled</span><span class="p">,</span><span class="n">sizeZ</span><span class="p">,</span><span class="n">sizeY</span><span class="p">,</span><span class="n">delta</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">pooled</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">starZ</span> <span class="o">=</span> <span class="n">pooled</span><span class="p">[:</span><span class="n">sizeZ</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">starY</span> <span class="o">=</span> <span class="n">pooled</span><span class="p">[</span><span class="o">-</span><span class="n">sizeY</span><span class="p">:]</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">starZ</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">starY</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gp">...</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pooled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">z</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">delta</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numSamples</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">estimates</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">run_permutation_test</span><span class="p">(</span><span class="n">pooled</span><span class="p">,</span><span class="n">z</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">delta</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="n">numSamples</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">estimates</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diffCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">estimates</span> <span class="o">&lt;=</span><span class="n">delta</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hat_asl_perm</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">diffCount</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">numSamples</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hat_asl_perm</span>
<span class="go">0.14070000000000005</span>
</pre></div>
</div>
<p>and we fail to reject the null hypothesis.</p>
</div>
<div class="section" id="further-notes">
<h2>Further Notes<a class="headerlink" href="#further-notes" title="Permalink to this headline">¶</a></h2>
<p>An alternative way to analyze these data is to use normal theory and assume that both underlying distributions are Gaussian.  We can then calculate the <em>achieved significance level</em> ASL as</p>
<div class="math">
<p><img src="../_images/math/ab206137f6c5aadcb6f05235f069686ad323b378.png" alt="ASL = 1 - \Phi \left( \frac{\hat{\theta}}{\sigma \sqrt{1/n+1/m}} \right)"/></p>
</div><p>where <img class="math" src="../_images/math/b85bbfb165b853d6f5f9734be4cdabbb453f4e43.png" alt="\Phi"/> is the standard normal cdf.  Because <img class="math" src="../_images/math/fa35d9fc104207e09a712110ac81612c5b279a6c.png" alt="\sigma"/> is unknown we can use</p>
<div class="math">
<p><img src="../_images/math/3921e46dda810a7e712fb0e46ebc8b26d2bb2282.png" alt="\bar{\sigma} = \left\{ \frac{ \sum^{n}_{i=1} (z_{i}-\bar{z})^{2} + \sum^{m}_{j=1} (y_{j}-\bar{y})^{2} } {n+m-2} \right\}^{\frac{1}{2}}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sigma_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">z</span><span class="o">-</span><span class="n">z</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sigma_bar</span>
<span class="go">54.235210425392665</span>
</pre></div>
</div>
<p>such that</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">stats</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_hat</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_bar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">1.0</span><span class="o">/</span><span class="n">z</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">))))</span>
<span class="go">0.13117683784495782</span>
</pre></div>
</div>
<p>Instead of estimating the variance with <img class="math" src="../_images/math/7bf2d869913026061af921cefc72c9d0e29c3a3f.png" alt="\bar{\sigma}"/>, a fixed constant, we can use Student&#8217;s <em>t</em>-test.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">theta_hat</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_bar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">1.0</span><span class="o">/</span><span class="n">z</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">y</span><span class="o">.</span><span class="n">size</span><span class="p">))),</span><span class="mi">14</span><span class="p">)</span>
<span class="go">0.1406062923976501</span>
</pre></div>
</div>
<p>In both cases we fail to reject the null.</p>
</div>
<div class="section" id="bibliographic-notes">
<h2>Bibliographic notes<a class="headerlink" href="#bibliographic-notes" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Efron, Bradley and Tibshirani, R. J., An Introduction to the Bootstrap,Chapman &amp; Hall/CRC Monographs on Statistics &amp; Applied Probability, 1994.</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="simple">
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ReproducibleResearch.html">Reproducible Research</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tutorial.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ExamplesGallery.html">Gallery of examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Resources.html">Resources and Presentations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contributors.html">Contributers</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lpEdit.html">lpEdit</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="PlotsPythonInLatex.html" title="Python Plots in LaTeX"
             >previous</a> |
          <a href="bayes-linreg.html" title="Bayesian Linear Regression"
             >next</a> |
          <a href="../genindex.html" title="General Index"
             >index</a>
            <br/>
            <a href="../_sources/examples-gallery/PermutationTest.txt"
               rel="nofollow">Show Source</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2013, Kouros Owzar, Andrzej Kosinski and Adam Richards.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>